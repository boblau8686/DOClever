{"version":3,"sources":["webpack:///./web/team/team.js","webpack:///./web/team/store.js"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,SAAS;AACT,KAAK;AACL,CAAC;AACD;AACA;AACA,CAAC,C;;;;;;;;ACnRD;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,CAAC,E","file":"team.js","sourcesContent":["/**\n * Created by sunxin on 2016/12/19.\n */\nvar mainNav=require(\"../component/mainNav.vue\");\nvar teamInfo=require(\"./component/teamInfo.vue\");\nvar teamProjectList=require(\"./component/teamProjectList.vue\");\nvar teamUser=require(\"./component/teamUser.vue\");\nvar store=require(\"./store\");\nvar sessionChange=require(\"../mixins/session\");\nif(!session.get(\"teamId\"))\n{\n    location.href=\"../project/project.html\"\n}\nsession.remove(\"projectId\");\nsession.remove(\"projectName\");\nsession.remove(\"versionId\");\nsession.remove(\"versionName\");\nsession.remove(\"versionDis\");\nvar vue=new Vue({\n    el: \"#app\",\n    data: {\n        type:1,\n        showAdd:false,\n        addPending:false,\n        newType:0,\n        name:\"\",\n        dis:\"\",\n        id:\"\",\n        arrApply:[],\n        showApply:false,\n        applyPending:false,\n        showUserApply:false,\n        newUserGroup:\"\",\n        newUserRole:1,\n        selUserApplyObj:{}\n    },\n    mixins:[sessionChange],\n    store:store,\n    components:{\n        \"mainnav\":mainNav,\n        \"teaminfo\":teamInfo,\n        \"teamprojectlist\":teamProjectList,\n        \"teamuser\":teamUser\n    },\n    computed:{\n        user:function () {\n            return store.state.user;\n        },\n        ownRole:function () {\n            return store.getters.ownRole;\n        },\n        manageRole:function () {\n            return store.getters.manageRole;\n        }\n    },\n    methods:{\n        addProject:function () {\n            var _this=this;\n            if(this.newType==0)\n            {\n                if(!this.name)\n                {\n                    this.$message.error(\"请输入名称\");\n                    return;\n                }\n                this.addPending=true;\n                net.post(\"/project/create\",{\n                    name:_this.name,\n                    dis:_this.dis,\n                    team:session.get(\"teamId\")\n                }).then(function (data) {\n                    _this.addPending=false;\n                    _this.name=\"\";\n                    _this.dis=\"\"\n                    if(data.code==200)\n                    {\n                        store.state.project.unshift(data.data);\n                        $.notify(\"创建成功\",1);\n                        _this.showAdd=false;\n                    }\n                    else\n                    {\n                        $.notify(data.msg,0);\n                    }\n                })\n            }\n            else\n            {\n                if(!this.id)\n                {\n                    this.$message.error(\"请输入项目ID\");\n                    return;\n                }\n                this.addPending=true;\n                net.put(\"/team/pullproject\",{\n                    id:session.get(\"teamId\"),\n                    project:this.id\n                }).then(function (data) {\n                    _this.addPending=false;\n                    _this.name=\"\";\n                    _this.dis=\"\"\n                    _this.id=\"\"\n                    if(data.code==200)\n                    {\n                        $.notify(\"请求已发出，等待项目管理员响应\",1);\n                        _this.showAdd=false;\n                    }\n                    else\n                    {\n                        $.notify(data.msg,0);\n                    }\n                })\n            }\n        },\n        importProject:function () {\n            $.showBox(this,\"importProject\");\n        },\n        addGroup:function () {\n            var _this=this;\n            $.input(\"请输入部门名称\",function (val) {\n                if(!val.value)\n                {\n                    $.tip(\"请输入部门名称\",0);\n                    return;\n                }\n                $.startHud();\n                net.post(\"/team/group\",{\n                    id:session.get(\"teamId\"),\n                    name:val.value\n                }).then(function (data) {\n                    $.stopHud();\n                    if(data.code==200)\n                    {\n                        $.notify(\"新建成功\",1);\n                        store.state.user.push(data.data);\n                    }\n                    else\n                    {\n                        $.notify(data.msg,0);\n                    }\n                })\n            })\n        },\n        handleApply:function (item,state) {\n            var _this=this;\n            if(item.type==2)\n            {\n                this.newUserGroup=store.state.user[0]._id;\n                this.newUserRole=1;\n                this.selUserApplyObj={\n                    item:item,\n                    state:state\n                }\n                if(state==1)\n                {\n                    this.showUserApply=true;\n                }\n                else\n                {\n                    this.handleUserApply();\n                }\n            }\n            else if(item.type==3)\n            {\n                $.startHud();\n                net.put(\"/team/apply\",{\n                    id:session.get(\"teamId\"),\n                    apply:item._id,\n                    state:state\n                }).then(function (data) {\n                    $.stopHud();\n                    if(data.code==200)\n                    {\n                        if(typeof(data.data)==\"object\")\n                        {\n                            item.handle=1;\n                            store.state.project.unshift(data.data);\n                        }\n                        else\n                        {\n                            item.handle=2;\n                        }\n                    }\n                    else\n                    {\n                        item.handle=3;\n                        $.notify(data.msg,0);\n                    }\n                })\n            }\n        },\n        handleUserApply:function () {\n            var _this=this;\n            this.applyPending=true;\n            net.put(\"/team/apply\",{\n                id:session.get(\"teamId\"),\n                apply:this.selUserApplyObj.item._id,\n                group:this.newUserGroup,\n                role:this.newUserRole,\n                state:this.selUserApplyObj.state\n            }).then(function (data) {\n                _this.applyPending=false;\n                if(data.code==200)\n                {\n                    if(typeof(data.data)==\"object\")\n                    {\n                        _this.selUserApplyObj.item.handle=1;\n                        store.state.user.forEach(function (obj) {\n                            if(obj._id==_this.newUserGroup)\n                            {\n                                obj.users.push(data.data);\n                                obj.users.sort(function (obj1,obj2) {\n                                    return obj1.user.name>obj2.user.name\n                                })\n                            }\n                        })\n                    }\n                    else\n                    {\n                        _this.selUserApplyObj.item.handle=2;\n                    }\n                }\n                else\n                {\n                    _this.selUserApplyObj.item.handle=3;\n                    $.notify(data.msg,0);\n                }\n                _this.showUserApply=false;\n            })\n        }\n    },\n    created:function () {\n        var _this=this;\n        Promise.all([\n            net.get(\"/team/info\",{\n                id:_this.session.teamId\n            }),\n            net.get(\"/team/apply\",{\n                id:_this.session.teamId\n            })\n        ]).then(function (arr) {\n            $.stopLoading();\n            var data1=arr[0];\n            var data2=arr[1];\n            if(data1.code==200)\n            {\n                store.commit(\"setTeam\",data1.data);\n                _this.newUserGroup=data1.data.user[0]._id;\n            }\n            else\n            {\n                throw data1.msg;\n            }\n            if(data2.code==200)\n            {\n                data2.data.forEach(function (obj) {\n                    obj.handle=0;\n                })\n                _this.arrApply=data2.data;\n                if(_this.arrApply.length>0)\n                {\n                    _this.showApply=true;\n                }\n            }\n            else\n            {\n                throw data2.msg;\n            }\n        }).catch(function (err) {\n            $.notify(err,0);\n        })\n    },\n})\n$.ready(function () {\n    $.startLoading();\n})\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./web/team/team.js\n// module id = 307\n// module chunks = 0","module.exports=new Vuex.Store({\n    state:{\n        team:{},\n        notice:[],\n        project:[],\n        user:[],\n        role:0\n    },\n    getters:{\n        userCount:function (state,getters) {\n            return state.user.length;\n        },\n        interfaceCount:function (state,getters) {\n            var count=0;\n            state.project.forEach(function (obj) {\n                count+=obj.interfaceCount;\n            })\n            return count;\n        },\n        projectCount:function (state,getters) {\n            return state.project.length;\n        },\n        ownRole:function (state) {\n            if(state.role==2)\n            {\n                return true;\n            }\n            else\n            {\n                return false;\n            }\n        },\n        manageRole:function (state) {\n            if(state.role==2 || state.role==0)\n            {\n                return true;\n            }\n            else\n            {\n                return false;\n            }\n        }\n    },\n    mutations:{\n        setTeam:function (state,data) {\n            state.team=data;\n            state.notice=data.notice;\n            state.project=data.project;\n            state.user=data.user;\n            state.role=data.role;\n        },\n    }\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./web/team/store.js\n// module id = 82\n// module chunks = 0"],"sourceRoot":""}